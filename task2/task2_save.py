from functools import reduce
from letter_map import letter_map

def save_container(container_path, message):
    with open(container_path, "r", encoding="utf-8") as f:
        container_content = f.read()

    binary_data = message.encode('cp1251')
    bits = reduce(lambda acc, bit_item: acc + bin(bit_item)[2:].rjust(8, '0'), binary_data, '')

    print(bits)

    #  Заменяем нужные буквы в контейнере
    i = 0
    for bit in bits:
        while container_content[i] not in letter_map:
            i += 1
        if int(bit) == 1:
            container_content = container_content[:i] + letter_map[container_content[i]] + container_content[i + 1:]
        i += 1
    with open(container_path, "w", encoding="utf-8") as f:
        f.write(container_content)


# text = """В конце ноября, в оттепель, часов в девять утра, поезд Петербургско-Варшавской железной дороги на всех парах подходил к Петербургу. Было так сыро и туманно, что насилу рассвело; в десяти шагах, вправо и влево от дороги, трудно было разглядеть хоть что-нибудь из окон вагона. Из пассажиров были и возвращавшиеся из-за границы; но более были наполнены отделения для третьего класса, и всё людом мелким и деловым, не из очень далека. Все, как водится, устали, у всех отяжелели за ночь глаза, все назяблись, все лица были бледно-желтые, под цвет тумана. В одном из вагонов третьего класса, с рассвета, очутились друг против друга, у самого окна, два пассажира — оба люди молодые, оба почти налегке, оба не щегольски одетые, оба с довольно замечательными физиономиями и оба пожелавшие, наконец, войти друг с другом в разговор. Если б они оба знали один про другого, чем они особенно в эту минуту замечательны, то, конечно, подивились бы, что случай так странно посадил их друг против друга в третьеклассном вагоне петербургско-варшавского поезда. Один из них был небольшого роста, лет двадцати семи, курчавый и почти черноволосый, с серыми маленькими, но огненными глазами. Нос его был широк и сплюснут, лицо скулистое; тонкие губы беспрерывно складывались в какую-то наглую, насмешливую и даже злую улыбку; но лоб его был высок и хорошо сформирован и скрашивал неблагородно развитую нижнюю часть лица. Особенно приметна была в этом лице его мертвая бледность, придававшая всей физиономии молодого человека изможденный вид, несмотря на довольно крепкое сложение, и вместе с тем что-то страстное, до страдания, не гармонировавшее с нахальною и грубою улыбкой и с резким, самодовольным его взглядом. Он был тепло одет, в широкий мерлушечий черный крытый тулуп, и за ночь не зяб, тогда как сосед его принужден был вынести на своей издрогшей спине всю сладость сырой ноябрьской русской ночи, к которой, очевидно, был не приготовлен. На нем был довольно широкий и толстый плащ без рукавов и с огромным капюшоном, точь-в-точь как употребляют часто дорожные, по зимам, где-нибудь далеко за границей, в Швейцарии или, например, в Северной Италии, не рассчитывая, конечно, при этом и на такие концы по дороге, как от Эйдткунена до Петербурга. Но что годилось и вполне удовлетворяло в Италии, то оказалось не совсем пригодным в России. Обладатель плаща с капюшоном был молодой человек, тоже лет двадцати шести или двадцати семи, роста немного повыше среднего, очень белокур, густоволос, со впалыми щеками и с легонькою, востренькою, почти совершенно белою бородкой. Глаза его были большие, голубые и пристальные; во взгляде их было что-то тихое, но тяжелое, что-то полное того странного выражения, по которому некоторые угадывают с первого взгляда в субъекте падучую болезнь. Лицо молодого человека было, впрочем, приятное, тонкое и сухое, но бесцветное, а теперь даже досиня иззябшее. В руках его болтался тощий узелок из старого, полинялого фуляра, заключавший, кажется, всё его дорожное достояние. На ногах его были толстоподошвенные башмаки с штиблетами, — всё не по-русски. Черноволосый сосед в крытом тулупе всё это разглядел, частию от нечего делать, и наконец спросил с тою неделикатною усмешкой, в которой так бесцеремонно и небрежно выражается иногда людское удовольствие при неудачах ближнего: — Это вот всё так и есть, — мрачно и насупившись подтвердил Рогожин, — тоже мне и Залёжев тогда говорил. Я тогда, князь, в третьегодняшней отцовской бекеше через Невский перебегал, а она из магазина выходит, в карету садится. Так меня тут и прожгло. Встречаю Залёжева, тот не мне чета, ходит как приказчик от парикмахера, и лорнет в глазу, а мы у родителя в смазных сапогах да на постных щах отличались. Это, говорит, не тебе чета, это, говорит, княгиня, а зовут ее Настасьей Филипповной, фамилией Барашкова, и живет с Тоцким, а Тоцкий от нее как отвязаться теперь не знает, потому совсем то есть лет достиг настоящих, пятидесяти пяти, и жениться на первейшей раскрасавице во всем Петербурге хочет. Тут он мне и внушил, что сегодня же можешь Настасью Филипповну в Большом театре видеть, в балете, в ложе своей, в бенуаре, будет сидеть. У нас, у родителя, попробуй-ка в балет сходить, — одна расправа, убьет! Я, однако же, на час втихомолку сбегал и Настасью Филипповну опять видел; всю ту ночь не спал. Наутро покойник дает мне два пятипроцентные билета, по пяти тысяч каждый, сходи, дескать, да продай, да семь тысяч пятьсот к Андреевым на контору снеси, уплати, а остальную сдачу с десяти тысяч, не заходя никуда, мне представь; буду тебя дожидаться. Билеты-то я продал, деньги взял, а к Андреевым в контору не заходил, а пошел, никуда не глядя, в английский магазин да на все пару подвесок и выбрал, по одному бриллиантику в каждой, этак почти как по ореху будут, четыреста рублей должен остался, имя сказал, поверили. С подвесками я к Залёжеву: так и так, идем, брат, к Настасье Филипповне. Отправились. Что у меня тогда под ногами, что предо мною, что по бокам — ничего я этого не знаю и не помню. Прямо к ней в залу вошли, сама вышла к нам. Я то есть тогда не сказался, что это я самый и есть; а «от Парфена, дескать, Рогожина, — говорит Залёжев, — вам в память встречи вчерашнего дня; соблаговолите принять». Раскрыла, взглянула, усмехнулась: «Благодарите, говорит, вашего друга господина Рогожина за его любезное внимание», — откланялась и ушла. Ну, вот зачем я тут не помер тогда же! Да если и пошел, так потому, что думал: «Всё равно, живой не вернусь!» А обиднее всего мне то показалось, что этот бестия Залёжев всё на себя присвоил. Я и ростом мал, и одет как холуй, и стою, молчу, на нее глаза пялю, потому стыдно, а он по всей моде, в помаде и завитой, румяный, галстух клетчатый, — так и рассыпается, так и расшаркивается, и уж наверно она его тут вместо меня приняла! «Ну, говорю, как мы вышли, ты у меня теперь тут не смей и подумать, понимаешь!» Смеется: «А вот как-то ты теперь Семену Парфенычу отчет отдавать будешь?» Я, правда, хотел было тогда же в воду, домой не заходя, да думаю: «Ведь уж всё равно», — и как окаянный воротился домой. — Эх! Ух! — кривился чиновник, и даже дрожь его пробирала, — а ведь покойник не то что за десять тысяч, а за десять целковых на тот свет сживывал, — кивнул он князю. Князь с любопытством рассматривал Рогожина; казалось, тот был еще бледнее в эту минуту. — «Сживывал»! — переговорил Рогожин. — Ты что знаешь? Тотчас, — продолжал он князю, — про всё узнал, да и Залёжев каждому встречному пошел болтать. Взял меня родитель, и наверху запер, и целый час поучал. «Это я только, говорит, предуготовляю тебя, а вот я с тобой еще на ночь попрощаться зайду». Что ж ты думаешь? Поехал седой к Настасье Филипповне, земно ей кланялся, умолял и плакал; вынесла она ему наконец коробку, шваркнула: «Вот, говорит, тебе, старая борода, твои серьги, а они мне теперь в десять раз дороже ценой, коли из-под такой грозы их Парфен добывал. Кланяйся, говорит, и благодари Парфена Семеныча». Ну, а я этой порой, по матушкину благословению, у Сережки Протушина двадцать рублей достал да во Псков по машине и отправился, да приехал-то в лихорадке; меня там святцами зачитывать старухи принялись, а я пьян сижу, да пошел потом по кабакам на последние, да в бесчувствии всю ночь на улице и провалялся, ан к утру горячка, а тем временем за ночь еще собаки обгрызли. Насилу очнулся."""
message = "A я"

container_path = "./container.txt"

save_container(container_path, message)

